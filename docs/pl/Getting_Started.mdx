<LocalePicker currentLocale="pl" />

# Tworzenie pierwszej aplikacji Discorda

Aplikacje Discorda pozwalajÄ… spersonalizowaÄ‡ i wzbogaciÄ‡ serwery przy pomocy API i interaktywnych funkcji. W tym przewodniku dowiesz siÄ™, jak stworzyÄ‡ pierwszÄ… aplikacjÄ™ Discorda w jÄ™zyku JavaScript, ktÃ³ra wykorzystuje polecenia z ukoÅ›nikiem, wysyÅ‚a wiadomoÅ›ci i reaguje na interakcje z elementami.

Zaczniemy od stworzenia aplikacji Discorda, ktÃ³ra pozwala czÅ‚onkom serwera graÄ‡ w papier, kamieÅ„, noÅ¼yce (z 7 wyborami zamiast 3 wyborÃ³w, jak w tradycyjnej wersji gry). Ten przewodnik jest przeznaczony dla poczÄ…tkujÄ…cych, ale zakÅ‚ada, Å¼e znasz podstawy jÄ™zyka [JavaScript](https://developer.mozilla.org/en-US/docs/Learn/Getting_started_with_the_web/JavaScript_basics).

<Collapsible title="Tworzona aplikacja" icon="view">
Oto, jak bÄ™dzie wyglÄ…daÅ‚a gotowa aplikacja:

![Demonstracja przykÅ‚adowej aplikacji](getting-started-demo.gif)

PoniÅ¼ej przedstawiono szczegÃ³Å‚owy zarys przepÅ‚ywu uÅ¼ytkownikÃ³w:

1. UÅ¼ytkownik 1 rozpoczyna nowÄ… grÄ™ i wybiera obiekt przy pomocy polecenia z ukoÅ›nikiem `/challenge`
2. Na kanaÅ‚ zostaje wysÅ‚ana wiadomoÅ›Ä‡ z przyciskiem zachÄ™cajÄ…cym innych do przyjÄ™cia wyzwania
3. UÅ¼ytkownik 2 naciska przycisk **Accept** (Przyjmij)
4. UÅ¼ytkownik 2 otrzymuje znikajÄ…cÄ… wiadomoÅ›Ä‡, w ktÃ³rej wybiera obiekt
5. Wynik gry jest publikowany dla wszystkich na pierwotnym kanale
</Collapsible>

<Collapsible title="Zasoby uÅ¼yte w tym przewodniku" description="Podsumowanie narzÄ™dzi i technologii, ktÃ³rych bÄ™dziemy uÅ¼ywaÄ‡" icon="list">
- **[Repozytorium GitHuba](https://github.com/discord/discord-example-app)**, gdzie znajdziesz kod z tego przewodnika wraz z dodatkowymi przykÅ‚adami kodu przedstawiajÄ…cymi okreÅ›lone funkcje.
- **[discord-interactions](https://github.com/discord/discord-interactions-js)**, biblioteka zawierajÄ…ca typy i pomocnicze funkcje do aplikacji Discorda.
- **[Express](https://expressjs.com)**, popularny framework sieciowy JavaScript, ktÃ³rego uÅ¼yjemy do utworzenia serwera, na ktÃ³ry Discord moÅ¼e wysyÅ‚aÄ‡ Å¼Ä…dania.
- **[Glitch](https://glitch.com/)**, internetowe Å›rodowisko, ktÃ³re upraszcza projektowanie i hostowanie aplikacji na wczesnym etapie prototypu i rozwoju. MoÅ¼esz teÅ¼ projektowaÄ‡ aplikacjÄ™ lokalnie przy pomocy narzÄ™dzia takiego jak **[ngrok](https://ngrok.com/)**.
</Collapsible>

---

## Krok 1: Tworzenie aplikacji

Najpierw musisz stworzyÄ‡ aplikacjÄ™ w portalu deweloperÃ³w, jeÅ›li jeszcze tego nie zrobiÅ‚eÅ›:

<Button href="https://discord.com/developers/applications?new_application=true" color="brand">StwÃ³rz aplikacjÄ™</Button>

WprowadÅº nazwÄ™ aplikacji i naciÅ›nij **StwÃ³rz**.

Po utworzeniu aplikacji zostanie wyÅ›wietlona strona **PrzeglÄ…d** ustawieÅ„ aplikacji, gdzie moÅ¼esz zaktualizowaÄ‡ podstawowe dane swojej aplikacji takie jak jej opis i ikona. Znajdziesz tutaj rÃ³wnieÅ¼ **ID aplikacji** i **koÅ„cowy adres URL interakcji**, ktÃ³re wykorzystamy w pÃ³Åºniejszej czÄ™Å›ci przewodnika.

### Konfigurowanie bota

W nastÄ™pnej kolejnoÅ›ci skonfigurujemy [uÅ¼ytkownika bota](#DOCS_TOPICS_OAUTH2/bot-vs-user-accounts) Twojej aplikacji, dziÄ™ki ktÃ³remu bÄ™dzie ona wyglÄ…daÄ‡ i zachowywaÄ‡ siÄ™ podobnie do innych czÅ‚onkÃ³w serwera.

Na lewym pasku bocznym kliknij **Bot**. Na tej stronie moÅ¼esz skonfigurowaÄ‡ ustawienia takie jak [uprawnienia intent typu â€privilegedâ€](#DOCS_TOPICS_GATEWAY/privileged-intents) lub okreÅ›liÄ‡, czy bot moÅ¼e byÄ‡ instalowany przez innych uÅ¼ytkownikÃ³w.

<Collapsible title="Czym sÄ… uprawnienia intent?" description="Wprowadzenie do standardowych uprawnieÅ„ intent i uprawnieÅ„ intent typu â€privilegedâ€" icon="question">
Uprawnienia intent okreÅ›lajÄ…, ktÃ³re zdarzenia Discord bÄ™dzie wysyÅ‚aÄ‡ do Twojej aplikacji, gdy tworzysz [poÅ‚Ä…czenie API bramki](#DOCS_TOPICS_GATEWAY). PrzykÅ‚adowo jeÅ›li chcesz, aby aplikacja wykonaÅ‚a jakÄ…Å› czynnoÅ›Ä‡, gdy uÅ¼ytkownicy dodadzÄ… reakcjÄ™ do wiadomoÅ›ci, moÅ¼esz przekazaÄ‡ uprawnienie intent `GUILD_MESSAGE_REACTIONS` (`1 << 10`).

NiektÃ³re uprawnienia intent sÄ… â€[privileged](#DOCS_TOPICS_GATEWAY/privileged-intents)â€, co znaczy, Å¼e zezwalajÄ… aplikacji na dostÄ™p do danych, ktÃ³re moÅ¼na uznaÄ‡ za wraÅ¼liwe (takich jak zawartoÅ›Ä‡ wiadomoÅ›ci). Uprawnienia intent typu â€privilegedâ€ sÄ… wyÅ›wietlane i mogÄ… zostaÄ‡ wÅ‚Ä…czone/wyÅ‚Ä…czone na stronie **Bot** ustawieÅ„ aplikacji. Standardowe uprawnienia intent (â€non-privilegedâ€) nie wymagajÄ… dodatkowych uprawnieÅ„ ani konfiguracji.

WiÄ™cej informacji na temat uprawnieÅ„ intent i peÅ‚nÄ… ich listÄ™, wraz z powiÄ…zanymi zdarzeniami, znajdziesz w [dokumentacji bramki](#DOCS_TOPICS_GATEWAY/gateway-intents).
</Collapsible>

![Karta Bot w ustawieniach aplikacji](app-add-bot.png)

Na stronie **Bot** znajduje siÄ™ sekcja **Token**, gdzie moÅ¼esz skopiowaÄ‡ i zresetowaÄ‡ token bota.

Tokeny bota sÅ‚uÅ¼Ä… do uwierzytelniania Å¼Ä…daÅ„ API i zawierajÄ… uprawnienia uÅ¼ytkownika bota, co czyni je *bardzo wraÅ¼liwymi*. *Nigdy* nie udostÄ™pniaj swojego tokena ani nie umieszczaj go w systemie kontroli wersji.

Skopiuj token i zapisz go w bezpiecznym miejscu (np. menedÅ¼erze haseÅ‚).

> warn
> Nie bÄ™dzie moÅ¼na wyÅ›wietliÄ‡ tokena ponownie, chyba Å¼e wygenerujesz go od nowa, wiÄ™c przechowaj token w bezpiecznym miejscu.

### Dodawanie zakresÃ³w i uprawnieÅ„ bota

Aplikacje potrzebujÄ… zgody instalujÄ…cych je uÅ¼ytkownikÃ³w, aby wykonywaÄ‡ czynnoÅ›ci na Discordzie (takie jak tworzenie polecenia z ukoÅ›nikiem lub pobieranie listy czÅ‚onkÃ³w serwera). Wybierzmy kilka zakresÃ³w i uprawnieÅ„, o ktÃ³rych przyznanie bÄ™dziemy prosiÄ‡ przed instalacjÄ… aplikacji.

<Collapsible title="Czym sÄ… zakresy i uprawnienia?" description="Wprowadzenie do zakresÃ³w i uprawnieÅ„ botÃ³w" icon="question">
Podczas tworzenia aplikacji zakresy i uprawnienia okreÅ›lajÄ…, co Twoja aplikacja moÅ¼e robiÄ‡ i do czego ma dostÄ™p na serwerach Discorda.

- [Zakresy OAuth2](#DOCS_TOPICS_OAUTH2/shared-resources-oauth2-scopes) okreÅ›lajÄ…, do ktÃ³rych danych aplikacja moÅ¼e uzyskiwaÄ‡ dostÄ™p i jakie czynnoÅ›ci moÅ¼e wykonywaÄ‡ w imieniu instalujÄ…cego lub uwierzytelniajÄ…cego uÅ¼ytkownika.
- [Uprawnienia](#DOCS_TOPICS_PERMISSIONS/permission-overwrites) sÄ… szczegÃ³Å‚owymi uprawnieniami dla uÅ¼ytkownika bota â€“ takimi samymi jak te, ktÃ³re posiadajÄ… inni uÅ¼ytkownicy na Discordzie. Uprawnienia te mogÄ… zostaÄ‡ przyznane przez instalujÄ…cego uÅ¼ytkownika lub zaktualizowane pÃ³Åºniej w ustawieniach serwera bÄ…dÅº przy pomocy [nadpisaÅ„ uprawnieÅ„](#DOCS_TOPICS_PERMISSIONS/permission-overwrites).
</Collapsible>

Kliknij **OAuth2** na lewym pasku bocznym, a nastÄ™pnie wybierz **Generator adresu URL**.

> info
> Generator adresu URL tworzy Å‚Ä…cze instalacyjne na podstawie zakresÃ³w i uprawnieÅ„ wybranych dla aplikacji. MoÅ¼esz uÅ¼yÄ‡ Å‚Ä…cza do instalacji aplikacji na swoim serwerze lub udostÄ™pniÄ‡ je innym, aby mogli zainstalowaÄ‡ aplikacjÄ™.

Na razie dodaj dwa zakresy:
- `applications.commands`, ktÃ³ry umoÅ¼liwia aplikacji tworzenie [poleceÅ„](#DOCS_INTERACTIONS_APPLICATION_COMMANDS).
- `bot` dodaje Twojego uÅ¼ytkownika bota. Po wybraniu `bot` moÅ¼esz rÃ³wnieÅ¼ wybraÄ‡ rÃ³Å¼ne uprawnienia bota. Na razie zaznacz tylko **WysyÅ‚anie wiadomoÅ›ci**.

Zobacz listÄ™ wszystkich [zakresÃ³w OAuth2](#DOCS_TOPICS_OAUTH2/shared-resources-oauth2-scopes) lub przeczytaj wiÄ™cej na temat [uprawnieÅ„](#DOCS_TOPICS_PERMISSIONS) w dokumentacji.

### Instalacja aplikacji

Po dodaniu zakresÃ³w powinien zostaÄ‡ wyÅ›wietlony adres URL, ktÃ³ry moÅ¼esz skopiowaÄ‡ w celu instalacji aplikacji.

![Zrzut ekranu generatora adresu URL](url-generator.png)

> info
> Podczas pracy nad aplikacjami naleÅ¼y budowaÄ‡ i testowaÄ‡ je na serwerze, ktÃ³ry nie jest aktywnie uÅ¼ywany przez innych. JeÅ›li nie masz jeszcze wÅ‚asnego serwera, moÅ¼esz [utworzyÄ‡ go za darmo](https://support.discord.com/hc/pl/articles/204849977-Jak-stworzy%C4%87-serwer-).

Skopiuj powyÅ¼szy adres URL i wklej go w swojej przeglÄ…darce. Zostanie wyÅ›wietlony interfejs instalacji, w ktÃ³rym naleÅ¼y upewniÄ‡ siÄ™, Å¼e instalujesz aplikacjÄ™ na serwerze, na ktÃ³rym moÅ¼esz jÄ… rozwijaÄ‡ i testowaÄ‡.

Po zainstalowaniu aplikacji przejdÅº do serwera, aby zobaczyÄ‡, czy zostaÅ‚a do niego dodana âœ¨

Po skonfigurowaniu i zainstalowaniu aplikacji moÅ¼emy zaczÄ…Ä‡ pracÄ™ nad niÄ….

---

## Krok 2: Uruchomienie aplikacji

CaÅ‚y kod przykÅ‚adowej aplikacji moÅ¼na znaleÅºÄ‡ w [repozytorium GitHuba](https://github.com/discord/discord-example-app).

Aby uproÅ›ciÄ‡ nieco pracÄ™, aplikacja wykorzystuje bibliotekÄ™ [discord-interactions](https://github.com/discord/discord-interactions-js), ktÃ³ra zawiera typy i funkcje pomocnicze. JeÅ›li wolisz uÅ¼yÄ‡ innych jÄ™zykÃ³w lub bibliotek, zobacz dokumentacjÄ™ [Zasoby spoÅ‚ecznoÅ›ci](#DOCS_TOPICS_COMMUNITY_RESOURCES).

### Edycja projektu

W tym przewodniku uÅ¼ywamy narzÄ™dzia Glitch, ktÃ³re pozwala sklonowaÄ‡ aplikacjÄ™ i pracowaÄ‡ nad niÄ… w przeglÄ…darce. JeÅ›li wolisz pracowaÄ‡ nad aplikacjÄ… lokalnie, zobacz instrukcje dotyczÄ…ce uÅ¼ywania narzÄ™dzia ngrok [w README](https://github.com/discord/discord-example-app#running-app-locally).

> info
> ChoÄ‡ rozwiÄ…zanie Glitch znakomicie nadaje siÄ™ do pracy nad aplikacjÄ… i jej testowania, [ma ograniczenia techniczne](https://help.glitch.com/kb/article/17-technical-restrictions/), wiÄ™c naleÅ¼y rozwaÅ¼yÄ‡ uÅ¼ycie innych dostawcÃ³w usÅ‚ug hostingowych do publicznej wersji aplikacji.

Aby zaczÄ…Ä‡, **[edytuj (lub sklonuj) projekt Glitch ğŸ](https://glitch.com/edit/#!/import/git?url=https://github.com/discord/discord-example-app.git)**.

Po edytowaniu projektu zostanie otwarty nowy projekt Glitch.

<Collapsible title="Interfejs projektu Glitch" description="PrzeglÄ…d interfejsu projektu Glitch" icon="view">
![PrzeglÄ…d projektu Glitch](glitch-project.png)

- **Nazwa projektu** to unikalna nazwa produktu widoczna w lewym gÃ³rnym rogu
- **`.env`** to plik, w ktÃ³rym sÄ… przechowywane Twoje wszystkie dane uwierzytelniajÄ…ce do aplikacji
- **Dzienniki** zawierajÄ… dane wyjÅ›ciowe projektu â€“ pomagajÄ… one w ustaleniu, czy aplikacja dziaÅ‚a; znajdziesz tu rÃ³wnieÅ¼ informacje o wszelkich bÅ‚Ä™dach wystÄ™pujÄ…cych w aplikacji
- Przycisk **UdostÄ™pnij** w prawym gÃ³rnym rogu pozwala uzyskaÄ‡ aktywny adres URL projektu, ktÃ³ry bÄ™dzie potrzebny do skonfigurowania interaktywnoÅ›ci w dalszej czÄ™Å›ci przewodnika
</Collapsible>

#### Struktura projektu

Wszystkie pliki projektu sÄ… widoczne po lewej stronie projektu Glitch. PoniÅ¼ej przedstawiono przeglÄ…d gÅ‚Ã³wnych folderÃ³w i plikÃ³w:

```
â”œâ”€â”€ examples    -> krÃ³tkie, skupione na okreÅ›lonych funkcjach aplikacje przykÅ‚adowe,
â”‚   â”œâ”€â”€ app.js  -> gotowy kod app.js,
â”‚   â”œâ”€â”€ button.js
â”‚   â”œâ”€â”€ command.js
â”‚   â”œâ”€â”€ modal.js
â”‚   â”œâ”€â”€ selectMenu.js
â”œâ”€â”€ .env        -> Twoje dane uwierzytelniajÄ…ce i ID,
â”œâ”€â”€ app.js      -> gÅ‚Ã³wny punkt wejÅ›cia aplikacji,
â”œâ”€â”€ commands.js -> payloady poleceÅ„ z ukoÅ›nikiem + elementy pomocnicze,
â”œâ”€â”€ game.js     -> logika gry w papier, kamieÅ„, noÅ¼yce,
â”œâ”€â”€ utils.js    -> funkcje narzÄ™dzi i wyliczenia.
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â””â”€â”€ .gitignore
```

### Dodawanie danych uwierzytelniajÄ…cych

Plik `app.js` zawiera juÅ¼ kod, ale potrzebujesz tokena i ID aplikacji, aby przesyÅ‚aÄ‡ Å¼Ä…dania. Wszystkie dane uwierzytelniajÄ…ce mogÄ… byÄ‡ przechowywane bezpoÅ›rednio w pliku `.env`.

Najpierw skopiuj token uÅ¼ytkownika bota, o ktÃ³rym byÅ‚a mowa wczeÅ›niej, i wklej go w parametrze **`DISCORD_TOKEN`** w pliku `.env`.

NastÄ™pnie przejdÅº do strony **PrzeglÄ…d** aplikacji i skopiuj **ID aplikacji** oraz **publiczny klucz**. Wklej te wartoÅ›ci w pliku `.env` jako parametry **`APP_ID`** i **`PUBLIC_KEY`**.

Po skonfigurowaniu danych uwierzytelniajÄ…cych czas zainstalowaÄ‡ i wdroÅ¼yÄ‡ polecenia z ukoÅ›nikiem.

### Instalacja poleceÅ„ z ukoÅ›nikiem

> info
> Aplikacja wykorzystuje moduÅ‚ [`node-fetch`](https://github.com/node-fetch/node-fetch) do instalacji poleceÅ„ z ukoÅ›nikiem. Kod odpowiedzialny za instalacjÄ™ znajduje siÄ™ w pliku `utils.js`, w funkcji `DiscordRequest()`.

Projekt zawiera skrypt `register`, ktÃ³rego moÅ¼esz uÅ¼yÄ‡ do instalacji poleceÅ„ w elemencie `ALL_COMMANDS`, ktÃ³ry jest zdefiniowany na koÅ„cu pliku `commands.js`. Instaluje on polecenia jako globalne polecenia, wywoÅ‚ujÄ…c punkt koÅ„cowy [`PUT /applications/<APP_ID>/commands`](#DOCS_INTERACTIONS_APPLICATION_COMMANDS/bulk-overwrite-global-application-commands) API HTTP.

JeÅ›li chcesz spersonalizowaÄ‡ polecenia lub dodaÄ‡ ich wiÄ™cej, moÅ¼esz odnieÅ›Ä‡ siÄ™ do struktury poleceÅ„ przedstawionej w [ich dokumentacji](#DOCS_INTERACTIONS_APPLICATION_COMMANDS/application-command-object-application-command-structure).

Uruchom skrypt `register`, klikajÄ…c **Terminal** na dole projektu Glitch i wklejajÄ…c nastÄ™pujÄ…ce polecenie:

```
npm run register
```

NaciÅ›nij Enter, aby uruchomiÄ‡ polecenie.

JeÅ›li wrÃ³cisz do swojego serwera, zobaczysz polecenia z ukoÅ›nikiem. Ale jeÅ›li sprÃ³bujesz je uruchomiÄ‡, nic siÄ™ nie stanie, poniewaÅ¼ Twoja aplikacja nie otrzymuje ani nie obsÅ‚uguje Å¼Ä…daÅ„ od Discorda.

<Collapsible title="Czym sÄ… API Discorda?" description="PrzeglÄ…d API HTTP i bramki Discorda" icon="question">
Discord ma dwa API, ktÃ³re moÅ¼na Å‚Ä…czyÄ‡ w tworzonych aplikacjach:

- **[API HTTP](#DOCS_REFERENCE/http-api)** jest API w stylu REST przeznaczonym do ogÃ³lnych operacji takich jak wysyÅ‚anie i aktualizowanie danych na Discordzie lub pobieranie informacji o zasobie.
- **[API bramki](#DOCS_REFERENCE/gateway-websocket-api)** to oparte na protokole WebSocket API przydatne do utrzymywania stanu lub nasÅ‚uchiwania zdarzeÅ„ na serwerze Discorda. Nie bÄ™dziemy uÅ¼ywaÄ‡ go w tym przewodniku, ale wiÄ™cej informacji na temat tworzenia poÅ‚Ä…czenia z bramkÄ… i rÃ³Å¼nych zdarzeÅ„, ktÃ³re moÅ¼esz nasÅ‚uchiwaÄ‡, znajdziesz w [dokumentacji bramki](#DOCS_TOPICS_GATEWAY).
</Collapsible>

---

## Krok 3: ObsÅ‚uga interaktywnoÅ›ci

Aby umoÅ¼liwiÄ‡ aplikacji otrzymywanie Å¼Ä…daÅ„ w postaci poleceÅ„ z ukoÅ›nikiem (i innych interakcji), Discord potrzebuje adresu URL, na ktÃ³ry bÄ™dzie je wysyÅ‚aÄ‡. MoÅ¼na go skonfigurowaÄ‡ w ustawieniach aplikacji, w polu **KoÅ„cowy adres URL interakcji**.

### Dodawanie koÅ„cowego adresu URL interakcji

Projekty Glitch majÄ… publiczny adres URL, ktÃ³ry jest domyÅ›lnie ujawniony. Skopuj go, klikajÄ…c przycisk **UdostÄ™pnij** w prawym gÃ³rnym rogu, a nastÄ™pnie skopiuj Å‚Ä…cze projektu â€Aktywna witrynaâ€ blisko dolnej czÄ™Å›ci okna.

> info
> JeÅ›li pracujesz nad aplikacjÄ… lokalnie, zobacz instrukcje dotyczÄ…ce przekazywania Å¼Ä…daÅ„ do lokalnego Å›rodowiska [w README na GitHubie](https://github.com/discord/discord-example-app#running-app-locally).

Po skopiowaniu Å‚Ä…cza przejdÅº do ustawieÅ„ aplikacji z poziomu [portalu deweloperÃ³w](https://discord.com/developers/applications).

Na stronie **Informacje ogÃ³lne** aplikacji znajduje siÄ™ opcja **KoÅ„cowy adres URL interakcji**, gdzie moÅ¼esz wkleiÄ‡ adres URL swojej aplikacji i dodaÄ‡ do niego ciÄ…g `/interactions`, ktÃ³ry wskazuje lokalizacjÄ™, gdzie aplikacja Express bÄ™dzie nasÅ‚uchiwaÄ‡ Å¼Ä…daÅ„.

![KoÅ„cowy adres URL interakcji w ustawieniach aplikacji](interactions-url.png)

Kliknij **Zapisz zmiany** i upewnij siÄ™, Å¼e koÅ„cowy adres zostaÅ‚ pomyÅ›lnie zweryfikowany.

PrzykÅ‚adowa aplikacja obsÅ‚uguje weryfikacjÄ™ na dwa sposoby:
- Wykorzystuje `PUBLIC_KEY` i [pakiet discord-interactions](https://github.com/discord/discord-interactions-js#usage) z funkcjÄ… wrapper (zaimportowanÄ… z pliku `utils.js`), ktÃ³ra zapewnia zgodnoÅ›Ä‡ z interfejsem [Express`verify`](http://expressjs.com/en/5x/api.html#express.json). Jest ona uruchamiana za kaÅ¼dym razem, gdy Twoja aplikacja otrzyma Å¼Ä…danie.
- Funkcja reaguje na przychodzÄ…ce Å¼Ä…dania `PING`.

WiÄ™cej informacji na temat przygotowywania aplikacji na przyjmowanie interakcji znajdziesz w [dokumentacji interakcji](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/receiving-an-interaction).

### ObsÅ‚uga poleceÅ„ z ukoÅ›nikiem

Po zweryfikowaniu koÅ„cowego adresu URL przejdÅº do pliku `app.js` w projekcie i znajdÅº blok kodu odpowiadajÄ…cy za obsÅ‚ugÄ™ polecenia `/test`:

```javascript
// polecenie â€testâ€
if (name === 'test') {
    // WysyÅ‚a wiadomoÅ›Ä‡ na kanaÅ‚, na ktÃ³rym aktywowano polecenie
    return res.send({
    type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
    data: {
        // Pobiera losowe emoji do wysÅ‚ania z funkcji pomocniczej
        content: 'hello world ' + getRandomEmoji(),
    },
    });
}
```

PowyÅ¼szy kod reaguje na interakcjÄ™ z wiadomoÅ›ciÄ… na kanale, z ktÃ³rego pochodzi. MoÅ¼esz zobaczyÄ‡ wszystkie dostÄ™pne typy reakcji, takie jak reagowanie oknem, [w dokumentacji](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/interaction-response-object-interaction-callback-type).

> info
> `InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE` jest staÅ‚Ä… [eksportowanÄ… z pliku pakietu `discord-interactions`](https://github.com/discord/discord-interactions-js/blob/main/src/index.ts#L33)

PrzejdÅº do swojego serwera i upewnij siÄ™, Å¼e polecenie z ukoÅ›nikiem `/test` dziaÅ‚a. Gdy je aktywujesz, aplikacja powinna wysÅ‚aÄ‡ wiadomoÅ›Ä‡ z tekstem â€hello worldâ€ i losowym emoji.

W nastÄ™pnym punkcie dodamy polecenie wykorzystujÄ…ce opcje polecenia z ukoÅ›nikiem, przyciski i menu wyboru, aby stworzyÄ‡ grÄ™ w papier, kamieÅ„, noÅ¼yce.

---

## Krok 4: Dodanie elementÃ³w wiadomoÅ›ci

Polecenie `/challenge` bÄ™dzie uruchamiaÄ‡ grÄ™ w stylu gry w papier, kamieÅ„, noÅ¼yce. Po aktywowaniu polecenia aplikacja wyÅ›le na kanaÅ‚ wiadomoÅ›ci instruujÄ…ce uÅ¼ytkownikÃ³w, jak ukoÅ„czyÄ‡ grÄ™.

### Dodawanie polecenia z opcjami

Polecenie `/challenge`, zwane `CHALLENGE_COMMAND` w pliku `commands.js`, ma szereg opcji (`options`). W naszej aplikacji opcje sÄ… obiektami oznaczajÄ…cymi rÃ³Å¼ne elementy, ktÃ³re uÅ¼ytkownik moÅ¼e wybraÄ‡ podczas gry w papier, kamieÅ„, noÅ¼yce, generowane przy pomocy kluczy `RPSChoices` w pliku `game.js`.

WiÄ™cej o opcjach poleceÅ„ i ich strukturze przeczytasz [w dokumentacji](#DOCS_INTERACTIONS_APPLICATION_COMMANDS/application-command-object-application-command-option-structure).

> info
> ChoÄ‡ w tym przewodniku nie zagÅ‚Ä™bimy siÄ™ w plik `game.js`, moÅ¼esz poeksperymentowaÄ‡ z nim, zmieniajÄ…c polecenia lub ich opcje.

<Collapsible title="ObsÅ‚uga interakcji poprzez polecenia" description="Kod odpowiadajÄ…cy za obsÅ‚ugÄ™ polecenia â€challengeâ€ i reagowanie wiadomoÅ›ciÄ… z przyciskiem" icon="code" open>

Aby dodaÄ‡ obsÅ‚ugÄ™ polecenia `/challenge`, dodaj nastÄ™pujÄ…cy kod po bloku â€ifâ€ `if name === â€œtestâ€`:

```javascript
// Polecenie â€challengeâ€
if (name === 'challenge' && id) {
    const userId = req.body.member.user.id;
    // WybÃ³r obiektu uÅ¼ytkownika
    const objectName = req.body.data.options[0].value;

    // Tworzy aktywnÄ… grÄ™, uÅ¼ywajÄ…c ID wiadomoÅ›ci jako ID gry
    activeGames[id] = {
        id: userId,
        objectName,
    };

    return res.send({
    type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
    data: {
        content: `Rock papers scissors challenge from <@${userId}>`,
        components: [
        {
            type: MessageComponentTypes.ACTION_ROW,
            components: [
            {
                type: MessageComponentTypes.BUTTON,
                // DoÅ‚Ä…cza ID gry do pÃ³Åºniejszego uÅ¼ytku
                custom_id: `accept_button_${req.body.id}`,
                label: 'Accept',
                style: ButtonStyleTypes.PRIMARY,
            },
            ],
        },
        ],
    },
    });
}
```


> info
> JeÅ›li nie wiesz, gdzie wkleiÄ‡ kod, moÅ¼esz zobaczyÄ‡ peÅ‚en kod w pliku `examples/app.js` w projekcie Glitch lub w nadrzÄ™dnym pliku `app.js` [na GitFHubie](https://github.com/discord/discord-example-app/blob/main/app.js).

PowyÅ¼szy kod wykonuje szereg czynnoÅ›ci:
1. Przetwarza treÅ›Ä‡ Å¼Ä…dania w celu uzyskania ID uÅ¼ytkownika, ktÃ³ry aktywowaÅ‚ polecenie z ukoÅ›nikiem (`userId`), i wybranÄ… przez niego opcjÄ™ (wybrany obiekt) (`objectName`).
2. Dodaje nowÄ… grÄ™ do obiektu `activeGames` przy pomocy ID interakcji. Aktywna gra zapisuje elementy `userId` i `objectName`.
3. WysyÅ‚a na kanaÅ‚ wiadomoÅ›Ä‡ z przyciskiem z wartoÅ›ciÄ… `accept_button_<SOME_ID>` w polu `custom_id`.

> warn
> PrzykÅ‚adowy kod wykorzystuje obiekt przechowywany w pamiÄ™ci, ale na potrzeby publicznej wersji aplikacji zaleca siÄ™ uÅ¼ycie bazy danych.

Przy wysyÅ‚aniu [elementÃ³w wiadomoÅ›ci](#DOCS_INTERACTIONS_MESSAGE_COMPONENTS/what-is-a-component) indywidualne payloady sÄ… dodawane do tablicy `components`. Interaktywne elementy (takie jak przyciski) muszÄ… znajdowaÄ‡ siÄ™ w [rzÄ™dzie czynnoÅ›ci](#DOCS_INTERACTIONS_MESSAGE_COMPONENTS/action-rows), ktÃ³ry jest widoczny w przykÅ‚adowym kodzie.

ZwrÃ³Ä‡ uwagÄ™ na unikalny `custom_id` wysyÅ‚any z elementami wiadomoÅ›ci, w tym przypadku `accept_button_` z dodanym ID gry. `custom_id` pozwala obsÅ‚uÅ¼yÄ‡ Å¼Ä…dania przesyÅ‚ane przez Discorda, gdy ktoÅ› wejdzie w interakcjÄ™ z elementem â€“ zobaczysz za chwilÄ™, jak to wyglÄ…da.

Teraz gdy uÅ¼yjesz polecenia `/challenge` i wybierzesz opcjÄ™, Twoja aplikacja wyÅ›le wiadomoÅ›Ä‡ z przyciskiem **Accept** (Akceptuj). Dodajmy kod odpowiadajÄ…cy za obsÅ‚ugÄ™ naciÅ›niÄ™cia przycisku.

</Collapsible>

<Collapsible title="ObsÅ‚uga interakcji z przyciskiem" description="Kod odpowiadajÄ…cy za obsÅ‚ugÄ™ klikniÄ™Ä‡ przycisku i reagowanie znikajÄ…cÄ… wiadomoÅ›ciÄ…" icon="code" open>

Gdy uÅ¼ytkownicy wejdÄ… w interakcjÄ™ z elementem wiadomoÅ›ci, Discord wyÅ›le Å¼Ä…danie z [typem interakcji](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/interaction-object-interaction-type) `3` (lub wartoÅ›ciÄ… `MESSAGE_COMPONENT` przy uÅ¼ywaniu `discord-interactions`).

W celu skonfigurowania procedury obsÅ‚ugi przycisku sprawdzimy typ (`type`) interakcji, a nastÄ™pnie `custom_id`.

Wklej nastÄ™pujÄ…cy kod pod procedurÄ… obsÅ‚ugi typu dla `APPLICATION_COMMAND`:

```javascript
if (type === InteractionType.MESSAGE_COMPONENT) {
// custom_id konfigurowany w payloadzie przy wysyÅ‚aniu elementu wiadomoÅ›ci
const componentId = data.custom_id;

  if (componentId.startsWith('accept_button_')) {
    // Uzyskuje powiÄ…zany ID gry
    const gameId = componentId.replace('accept_button_', '');
    // Usuwa wiadomoÅ›Ä‡ z tokenem w treÅ›ci Å¼Ä…dania
    const endpoint = `webhooks/${process.env.APP_ID}/${req.body.token}/messages/${req.body.message.id}`;
    try {
      await res.send({
        type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
        data: {
          // Pobiera losowe emoji do wysÅ‚ania z funkcji pomocniczej
          content: 'What is your object of choice?',
          // OkreÅ›la, Å¼e wiadomoÅ›Ä‡ bÄ™dzie znikajÄ…ca
          flags: InteractionResponseFlags.EPHEMERAL,
          components: [
            {
              type: MessageComponentTypes.ACTION_ROW,
              components: [
                {
                  type: MessageComponentTypes.STRING_SELECT,
                  // Dodaje ID gry
                  custom_id: `select_choice_${gameId}`,
                  options: getShuffledOptions(),
                },
              ],
            },
          ],
        },
      });
      // Usuwa poprzedniÄ… wiadomoÅ›Ä‡
      await DiscordRequest(endpoint, { method: 'DELETE' });
    } catch (err) {
      console.error('Error sending message:', err);
    }
  }
}
```

PowyÅ¼szy kod:
1. Sprawdza, czy parametr `custom_id` jest zgodny z pierwotnie wysÅ‚anym parametrem (w tym przypadku zaczyna siÄ™ od `accept_button_`). Zawiera on rÃ³wnieÅ¼ ID aktywnej gry, wiÄ™c przechowujemy go w parametrze `gameID`.
2. [Usuwa pierwotnÄ… wiadomoÅ›Ä‡](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/delete-original-interaction-response), wywoÅ‚ujÄ…c webhook przy pomocy `node-fetch` i przekazujÄ…c `token` unikalnej interakcji w treÅ›ci Å¼Ä…dania. Jest to konieczne, aby zachowaÄ‡ porzÄ…dek na kanale i zapobiec klikaniu przycisku przez innych uÅ¼ytkownikÃ³w.
3. WysyÅ‚a w odpowiedzi na Å¼Ä…danie wiadomoÅ›Ä‡ zawierajÄ…cÄ… menu wyboru obiektu do gry. Payload powinien wyglÄ…daÄ‡ podobnie do poprzedniego, z wyjÄ…tkiem tabeli `options` i parametru `flags: 64`, [ktÃ³ry oznacza, Å¼e wiadomoÅ›Ä‡ jest znikajÄ…ca](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/create-followup-message).

Tabela `options` jest wypeÅ‚niana przy pomocy metody `getShuffledOptions()` w pliku `game.js`, ktÃ³ra dostosowuje wartoÅ›ci `RPSChoices` do formatu [opcji elementu wiadomoÅ›ci](#DOCS_INTERACTIONS_MESSAGE_COMPONENTS/select-menu-object-select-option-structure).

</Collapsible>

<Collapsible title="ObsÅ‚uga interakcji z menu" description="Kod odpowiedzialny za reagowanie na interakcje z menu wyboru i aktualizowanie stanu gry" icon="code" open>

Na koniec naleÅ¼y dodaÄ‡ kod odpowiedzialny za obsÅ‚ugÄ™ interakcji z menu wyboru i wysyÅ‚anie wyniku gry na kanaÅ‚.

PoniewaÅ¼ menu wyboru to tylko kolejny element wiadomoÅ›ci, kod odpowiedzialny za interakcjÄ™ z nim bÄ™dzie praktycznie taki sam jak w przypadku przyciskÃ³w.

Zmodyfikuj powyÅ¼szy kod pod kÄ…tem obsÅ‚ugi menu wyboru:

```javascript
if (type === InteractionType.MESSAGE_COMPONENT) {
// custom_id konfigurowany w payloadzie przy wysyÅ‚aniu elementu wiadomoÅ›ci
const componentId = data.custom_id;

  if (componentId.startsWith('accept_button_')) {
    // Uzyskuje powiÄ…zany ID gry
    const gameId = componentId.replace('accept_button_', '');
    // Usuwa wiadomoÅ›Ä‡ z tokenem w treÅ›ci Å¼Ä…dania
    const endpoint = `webhooks/${process.env.APP_ID}/${req.body.token}/messages/${req.body.message.id}`;
    try {
      await res.send({
        type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
        data: {
          // Pobiera losowe emoji do wysÅ‚ania z funkcji pomocniczej
          content: 'What is your object of choice?',
          // OkreÅ›la, Å¼e wiadomoÅ›Ä‡ bÄ™dzie znikajÄ…ca
          flags: InteractionResponseFlags.EPHEMERAL,
          components: [
            {
              type: MessageComponentTypes.ACTION_ROW,
              components: [
                {
                  type: MessageComponentTypes.STRING_SELECT,
                  // Dodaje ID gry
                  custom_id: `select_choice_${gameId}`,
                  options: getShuffledOptions(),
                },
              ],
            },
          ],
        },
      });
      // Usuwa poprzedniÄ… wiadomoÅ›Ä‡
      await DiscordRequest(endpoint, { method: 'DELETE' });
    } catch (err) {
      console.error('Error sending message:', err);
    }
  } else if (componentId.startsWith('select_choice_')) {
    // Uzyskuje powiÄ…zany ID gry
    const gameId = componentId.replace('select_choice_', '');

    if (activeGames[gameId]) {
      // Pobiera ID i obiekt wybrany przez odpowiadajÄ…cego uÅ¼ytkownika
      const userId = req.body.member.user.id;
      const objectName = data.values[0];
      // Oblicza wynik funkcji pomocniczej
      const resultStr = getResult(activeGames[gameId], {
        id: userId,
        objectName,
      });

      // Usuwa grÄ™ z dysku
      delete activeGames[gameId];
      // Aktualizuje wiadomoÅ›Ä‡ z tokenem w treÅ›ci Å¼Ä…dania
      const endpoint = `webhooks/${process.env.APP_ID}/${req.body.token}/messages/${req.body.message.id}`;

      try {
        // WysyÅ‚a wynik
        await res.send({
          type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
          data: { content: resultStr },
        });
        // Aktualizuje znikajÄ…cÄ… wiadomoÅ›Ä‡
        await DiscordRequest(endpoint, {
          method: 'PATCH',
          body: {
            content: 'Nice choice ' + getRandomEmoji(),
            components: []
          }
        });
      } catch (err) {
        console.error('Error sending message:', err);
      }
    }
  }
}
```

Podobnie jak w przypadku poprzedniego kodu, powyÅ¼szy kod pobiera ID uÅ¼ytkownika i wybrany przez niego obiekt z Å¼Ä…dania interakcji.

Te informacje, wraz z ID i wyborem pierwotnego uÅ¼ytkownika z obiektu `activeGames`, sÄ… przekazywane do funkcji `getResult()`. `getResult()` okreÅ›la zwyciÄ™zcÄ™, a nastÄ™pnie tworzy czytelny ciÄ…g, ktÃ³ry zostanie wysÅ‚any na kanaÅ‚.

WywoÅ‚ujemy rÃ³wnieÅ¼ kolejny webhook, tym razem w celu [aktualizacji nastÄ™pczej znikajÄ…cej wiadomoÅ›ci,](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/edit-followup-message) poniewaÅ¼ nie moÅ¼na jej usunÄ…Ä‡.

Na koniec wyniki sÄ… wysyÅ‚ane na kanaÅ‚ przy pomocy typu reakcji na interakcjÄ™ `CHANNEL_MESSAGE_WITH_SOURCE`.

</Collapsible>

To juÅ¼ wszystko ğŸŠ MoÅ¼esz teraz przetestowaÄ‡ swojÄ… aplikacjÄ™ i upewniÄ‡ siÄ™, Å¼e wszystko dziaÅ‚a.

---

## Kolejne kroki

Gratulujemy utworzenia pierwszej aplikacji Discorda! ğŸ¤–

Mamy nadziejÄ™, Å¼e ten artykuÅ‚ przybliÅ¼yÅ‚ Ci nieco aplikacje Discorda i to, jak moÅ¼na konfigurowaÄ‡ je i dodawaÄ‡ do nich interaktywne elementy. Teraz moÅ¼esz kontynuowaÄ‡ pracÄ™ nad swojÄ… aplikacjÄ… lub zobaczyÄ‡ inne moÅ¼liwoÅ›ci:
- Przeczytaj **[dokumentacjÄ™](#DOCS_INTRO)**, w ktÃ³rej znajdziesz szczegÃ³Å‚owe informacje o funkcjach API
- Zobacz folder `examples/` tego projektu, ktÃ³ry zawiera mniejsze, skupione na okreÅ›lonych funkcjach przykÅ‚ady kodu
- Zapoznaj siÄ™ z **[zasobami spoÅ‚ecznoÅ›ci](#DOCS_TOPICS_COMMUNITY_RESOURCES)** dotyczÄ…cymi przeznaczonych do okreÅ›lonych jÄ™zykÃ³w narzÄ™dzi tworzonych przez uÅ¼ytkownikÃ³w Discorda
- Przeczytaj nasz samouczek dotyczÄ…cy [hostowania aplikacji Discorda w serwisie Cloudflare Workers](#DOCS_TUTORIALS_HOSTING_ON_CLOUDFLARE_WORKERS)
- DoÅ‚Ä…cz do **[serwera Discord Developers](https://discord.gg/discord-developers)**, gdzie moÅ¼esz zadawaÄ‡ pytania na temat API, uczestniczyÄ‡ w wydarzeniach organizowanych przez zespÃ³Å‚ API Discorda i rozmawiaÄ‡ z innymi deweloperami

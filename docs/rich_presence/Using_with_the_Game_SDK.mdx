# Using Rich Presence with the Game SDK

The [Game SDK](#DEVELOPERS_DOCS_DEVELOPER_TOOLS_GAME_SDK) helps you build your 3rd party game, and integrate it with Discord. One of its specialties is making it easy to bring your game's data to Discord using [Rich Presence](#DOCS_RICH_PRESENCE_OVERVIEW), which is what this guide will cover.

Before we dig in, make sure you've gone through the guide on [Getting Started with the Game SDK](#DOCS_DEVELOPER_TOOLS_GAME_SDK/getting-started). This guide expects that you've already [downloaded the SDK](#DOCS_DEVELOPER_TOOLS_GAME_SDK/step-1-get-the-sdk),  [configured your app](#DOCS_DEVELOPER_TOOLS_GAME_SDK/step-2-create-your-app), and [gotten up and running with a basic example](#DOCS_DEVELOPER_TOOLS_GAME_SDK/step-3-start-coding).

> info
> Not sure if you should be building with the Game SDK? Read through [Choosing an SDK](#DOCS_RICH_PRESENCE_OVERVIEW/choosing-an-sdk) to understand your options when integrating Rich Presence.

## Understanding Rich Presence Data

Before we dig into the technical side, it's helpful to understand what Rich Presence data you can set when updating a user's presence. We'll explain the specific fields below, but for now let's just take a look at what we'll be working with visually:

![Graphical representation of the legend for rich presence details](rp-legend.png)

<Collapsible title="Table with text representation of the fields above" icon="view">
| location                               | field name     | notes                                                                       |
|----------------------------------------|----------------|-----------------------------------------------------------------------------|
| First row below title                  | details        |                                                                             |
| Second row below title                 | state          |                                                                             |
| Second row below title                 | partySize      | In parenthesis next to the `state`, first number in the format `(1 of 10)`  |
| Second row below title                 | partyMax       | In parenthesis next to the `state`, second number in the format `(1 of 10)` |
| Third row below title                  | startTimestamp | Converted to a format such as `01:33 elapsed`                               |
| First button at the bottom             | joinSecret     | Button has the text "Ask to join"                                           |
| Second button at the bottom            | spectateSecret | Button has the text "Spectate"                                              |
| Large image to the left of any content | largeImageKey  | Four rows high, includes the title but not the bottom buttons               |
| Small image to the left of any content | smallImageKey  | Small icon inset on the bottom right of the `largeImageKey`                 |

Note that this layout may be subject to change without warning. This information is only provided to help those with
impaired eyesight to understand the potential layout of this information in a user interface.
</Collapsible>

## Activities Manager

As you probably learned when setting up your app, the Game SDK has a handful of [manager classes](#DOCS_DEVELOPER_TOOLS_GAME_SDK/managers) that are specialized to either help you build a feature in your 3rd party game, or integrate your game with Discord. The **[`ActivitiesManager`](#DOCS_DEVELOPER_TOOLS_GAME_SDK/activities)** class is responsible for Rich Presence and sending invites, so that's where we'll spend our focus.

Like other Game SDK managers, the `ActivitiesManager` class has a handful of different [functions](#DOCS_DEVELOPER_TOOLS_GAME_SDK/functions) and [events](#DOCS_DEVELOPER_TOOLS_GAME_SDK/functions) that are used when building Rich Presence support. We'll touch on the important ones in the sections below.

### Fetching Activity Manager

In your code, you'll need to fetch the `ActivityManager` to call its functions and listen to events. In your code, you can call the `GetActivityManager()` function:

```cs
var activityManager = discord.GetActivityManager();
```

## Updating Presence

The most important function when integrating Rich Presence will be [`UpdateActivity()`](#DOCS_DEVELOPER_TOOLS_GAME_SDK/updateactivity). This is how you send your game data up to Discord to update a user's presence data. You should call `UpdateActivity()` any time something important in the presence payload changes.

### UpdateActivity Fields

When calling `UpdateActivity()`, you'll be expected to pass the [activity](#DOCS_DEVELOPER_TOOLS_GAME_SDK/activity-struct) fields besides your `ApplicationId` and `Name` (which are both read-only).

#### Partial Activity Struct

Below are the fields we'll be paying attention to as we're passing presence data for a user.

> info
> All fields are optional and nullable

| Name       | Type                                                                                  | Description                                                     |
|------------|---------------------------------------------------------------------------------------|-----------------------------------------------------------------|
| State      | string                                                                                | the player's current party status                               |
| Details    | string                                                                                | what the player is currently doing                              |
| Timestamps | [ActivityTimestamps](#DOCS_GAME_SDK_ACTIVITIES/data-models-activitytimestamps-struct) | helps create elapsed/remaining timestamps on a player's profile |
| Assets     | [ActivityAssets](#DOCS_GAME_SDK_ACTIVITIES/data-models-activityassets-struct)         | assets to display on the player's profile                       |
| Party      | [ActivityParty](#DOCS_GAME_SDK_ACTIVITIES/data-models-activityparty-struct)           | information about the player's party                            |
| Secrets    | [ActivitySecrets](#DOCS_GAME_SDK_ACTIVITIES/data-models-activitysecrets-struct)       | secret passwords for joining the player's game   |
| Instance | bool | whether this activity is an instanced context, like a match |

### UpdateActivity Example

Now let's take a look at a code example for updating presence data. All of the code samples are in C#, but there are some similar examples in other languages [on GitHub](https://github.com/msciotti/discord-game-sdk-test-apps).

Our code sample in this section is based on the data from the example from before:

![Example of presence data with buttons](game-sdk-presence-example.png)

This example contains two buttons—the **Ask to Join** button and the **Spectate** button. The **Ask to Join** button will be covered more in the following sections, but if you don't want it included, you can remove the `Party` and `Secret` fields.

> warn
> While the example shows a **Spectating** button, support for Spectating was removed and you can ignore references to it.

<Collapsible title="Example calling UpdateActivity function" icon="code" open>

> info
> The following example only focuses on using `UpdateActivity()`. You can read the [Getting Started](#DOCS_DEVELOPER_TOOLS_GAME_SDK/getting-started) and [Using the SDK](#DOCS_DEVELOPER_TOOLS_GAME_SDK/using-the-sdk) sections for more general information about using the Game SDK.

```cs
var activity = new Discord.Activity
{
  State = "In Group",
  Details = "In 3v3 Arena | 0-2 | Bo5",
  Timestamps =
  {
      Start = 1723218695,
  },
  Assets =
  {
      LargeImage = "map-woods", // using asset from app's settings
      LargeText = "Playing in the Misty Woods",
      SmallImage = "https://example.com/battlerite/users/example-user.jpg", // you can also use URLs
      SmallText = "Example User",
  },
  Party =
  {
      Id = "party-abc123",
      Size = {
          CurrentSize = 3,
          MaxSize = 3,
      },
  },
  Secrets =
  {
      Join = "foo joinSecret",
  },
  Instance = true,

};

activityManager.UpdateActivity(activity, (result) =>
{
    if (result == Discord.Result.Ok)
    {
        Console.WriteLine("Success!");
    }
    else
    {
        Console.WriteLine("Failed");
    }
});
```
</Collapsible>

## Asking to Join

In the example above, there was an **Ask to Join** button that a user could click to ask to join a game match directly from Discord.

### Adding the Ask to Join Button

To get the **Ask to Join** button to appear under the Rich Presence data for a 3rd party game, you have to send along a few fields: `ActivityParty.Id`, `ActivityParty.Size.CurrentSize`, `ActivityParty.Size.MaxSize`, and `ActivitySecrets.Join`.

To see what you need for each Rich Presence feature, you can view the [Activity Action Field Requirements](#DOCS_RICH_PRESENCE_USING_WITH_THE_GAME_SDK/rich-presence-field-requirements) table below.

### Handling Ask to Join

To listen for when someone clicks the Ask to Join button, you'll use the [`OnActivityJoinRequest` event](#DOCS_DEVELOPER_TOOLS_GAME_SDK/onactivityjoinrequest). This will include a [user](#DOCS_DEVELOPER_TOOLS_GAME_SDK/user-struct) for the individual that clicked the button.

Let's say we updated Player A's presence data, and Player B found the Ask to Join button on their profile then clicked it. At that point, you will receive an `OnActivityJoinRequest` and your game should surface this to Player A, and ask if they wish to play with Player B.

At that point, you can call [`SendRequestReply`](#DOCS_DEVELOPER_TOOLS_GAME_SDK/sendrequestreply) with Player B's `userId` and a `reply` field with one of the [`ActivityJoinRequestReply` values](#DOCS_DEVELOPER_TOOLS_GAME_SDK/activityjoinrequestreply-enum).

<Collapsible title="Example Listening to Ask to Join Request" icon="code">

```cs
activityManager.OnActivityJoinRequest += user =>
{
    Console.WriteLine("Join request from: {0}", user.Id);
    activityManager.SendRequestReply(user.Id, Discord.ActivityJoinRequestReply.Yes, (res) =>
    {
      if (res == Discord.Result.Ok)
      {
        Console.WriteLine("Responded successfully");
      }
    });
}
```
</Collapsible>

The Ask to Join request persists for 30 seconds after the request is received. Therefore, keep these two points in mind:
- Ensure you call [`RunCallbacks()`](#DOCS_DEVELOPER_TOOLS_GAME_SDK/runcallbacks) as frequently as possible to ensure your game client is up to date with any data from Discord
- If the player is in a state in which they cannot interact with an Ask to Join request—like in the middle of a match—you should not send `ActivitySecrets.Join` in the presence payload

## Secrets

Security is of the utmost importance to us here at Discord, and we know it is for you, too. That's why we want to make sure that you properly understand  `ActivitySecrets.Join` so that your game data is safe and secure over the wire.

To keep security on the up and up, Discord requires that you properly hash/encode/encrypt/put-a-padlock-on-and-swallow-the-key-but-wait-then-how-would-you-open-it your secrets.

Secrets are obfuscated data of your choosing. They could be match ids, player ids, lobby ids, etc. You should send us data that someone else's game client would need to join their friend. If you can't or don't want to support those actions, you don't need to send us secrets.

## Rich Presence Field Requirements

All fields in the `DiscordRichPresence` object are entirely optional. Anything you choose to omit simply won't be displayed; the UI will dynamically adapt from the full Rich Presence object all the way down to the basic presence view. We highly encourage you to include as many fields as you can to make your game as attractive and interactive for other players as possible. However, if you choose to be a bit more selective, here's a handy table for what each piece of Rich Presence requires:

###### Rich Presence Field Requirements

|     Field      | Custom Artwork | Joining | Ask to Join |
|:--------------:|:--------------:|:-------:|:-----------:|
|     state      |                |         |             |
|    details     |                |         |             |
| startTimestamp |                |         |             |
|  endTimestamp  |                |         |             |
| largeImageKey  |       x        |         |             |
| smallImageKey  |       x        |         |             |
| largeImageText |       x        |         |             |
| smallImageText |       x        |         |             |
|    partyId     |                |    x    |      x      |
|   partySize    |                |    x    |      x      |
|    partyMax    |                |    x    |      x      |
|  matchSecret   |                |         |             |
|   joinSecret   |                |    x    |      x      |
| spectateSecret |                |         |             |
|    instance    |                |         |             |

## FAQ

Below are answers to some common questions about integrating Rich Presence with your game.

#### Q: I see "Playing MyGame", but no Rich Presence data.

There's a couple things that could be going on:

- If you're running two instances of the Discord client, check both!
- Double check that your `Discord_Initialize()` function is correct.

Throughout development, make sure you have your `errored()` and `disconnected()` callbacks hooked up for debugging. You can open up the console in Discord and look for errors pertaining to `SET_ACTIVITY` for more information as well.

#### Q: What happens if someone has more than one game running that supports Rich Presence?

Due to recent changes in our infrastructure for support of multi-activities, the behavior of multiple connected Rich Presence apps has changed from what it was before. Previously, whichever application was focused would be the presence that was shown. With the recent changes, the application that connected _first_ is now displayed.

However, invite functionality across multiple connected applications now works no matter which app is display on a user's profile. For example, if you are hosting a Spotify listening party, playing Game A that allows you to send Join invites, and playing Game B that allows you to send Spectate invites, you'll be able to send invites to all three simultaneously!

#### Q: What if someone looking at my profile or an invite doesn't own the game?

Anyone can see your profile data, whether they own the game or not. They'll only be able to interact with chat invites or profile buttons if they own the game and have launched it at least once. Otherwise, the invite/button tooltip will show "Game Not Detected".

#### Q: Do join invitations allow players to select the number of open slots?

Currently, the SDK does not support this. Party slot information is determined by the party data you sent in your presence payload.

#### Q: Can I send images via the payload rather than uploading them to my Developer Dashboard?

Yes! In addition to uploading an asset and specifying its name, you can also specify an external image URL for us to proxy. For more information, see [Activity Asset Image](#DOCS_TOPICS_GATEWAY_EVENTS/activity-object-activity-asset-image).

#### Q: Can I change something in the SDK for my own purposes?

Go nuts! The SDK is open source by design. If you need or want to change something for the purposes of your specific integration—like changing our JSON parser, or changing all of the variable names to the names of your pets—go ahead and tinker to your heart's content.

#### Q: OK—I've got it working! Now, how do I make my integration look _awesome_?

I'm happy ~~we preempted your question~~ you asked! Check out our [Rich Presence Best Practices](#DOCS_BEST_PRACTICES_DESIGNING_YOUR_DATA_FOR_RICH_PRESENCE/) guide for a rundown on how to make your integration the best that it can be!
